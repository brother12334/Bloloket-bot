<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blooket Bot Sender</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #1e1e2e; color: white; }
        h1 { color: #ffcc00; }
        .container { background: #2a2a3b; padding: 20px; border-radius: 10px; width: 50%; margin: auto; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2); }
        input, button, select { width: 80%; padding: 10px; margin: 10px; border-radius: 5px; border: none; }
        input, select { background: #333; color: white; }
        button { background: #ffcc00; color: black; font-size: 16px; cursor: pointer; }
        button:hover { background: #e6b800; }
        .log { text-align: left; background: black; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: scroll; font-size: 14px; }
    </style>
</head>
<body>
    <h1>üî• Blooket Bot Sender üî•</h1>
    <div class="container">
        <p>Enter Game Code:</p>
        <input type="text" id="gcode" placeholder="7-digit game code">
        
        <p>Enter Bot Name Prefix:</p>
        <input type="text" id="gname" placeholder="Example: BlookBot">
        
        <p>Number of Bots:</p>
        <input type="number" id="numJoins" placeholder="How many bots?" min="1" max="100">
        
        <p>Select Bot Skin:</p>
        <select id="skinSelect">
            <!-- Dynamically add all skins from blooks -->
        </select>

        <button id="sendBotsBtn">üöÄ Send Bots!</button>
        
        <h3>Status:</h3>
        <div class="log" id="log">Waiting for input...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // Add skins to dropdown dynamically
        var blooks = [
          "Chick", "Chicken", "Cow", "Goat", "Horse", "Pig", "Sheep", "Duck", "Alpaca", "Dog",
          "Cat", "Rabbit", "Goldfish", "Hamster", "Turtle", "Kitten", "Puppy", "Bear", "Moose", 
          "Fox", "Raccoon", "Squirrel", "Owl", "Hedgehog", "Deer", "Wolf", "Beaver", "Tiger", 
          "Orangutan", "Cockatoo", "Parrot", "Anaconda", "Jaguar", "Macaw", "Toucan", "Panther", 
          "Capuchin", "Gorilla", "Hippo", "Rhino", "Giraffe", "Snowy Owl", "Polar Bear", "Arctic Fox", 
          "Baby Penguin", "Penguin", "Arctic Hare", "Seal", "Walrus", "Witch", "Wizard", "Elf", 
          "Fairy", "Slime Monster", "Jester", "Dragon", "Queen", "Unicorn", "King", "Two of Spades", 
          "Eat Me", "Drink Me", "Alice", "Queen of Hearts", "Dormouse", "White Rabbit", "Cheshire Cat", 
          "Caterpillar", "Mad Hatter", "King of Hearts", "Toast", "Cereal", "Yogurt", "Breakfast Combo", 
          "Orange Juice", "Milk", "Waffle", "Pancakes", "French Toast", "Pizza", "Earth", "Meteor", 
          "Stars", "Alien", "Planet", "UFO", "Spaceship", "Astronaut", "Lil Bot", "Lovely Bot", 
          "Angry Bot", "Happy Bot", "Watson", "Buddy Bot", "Brainy Bot", "Mega Bot", "Old Boot", 
          "Jellyfish", "Clownfish", "Frog", "Crab", "Pufferfish", "Blobfish", "Octopus", "Narwhal", 
          "Dolphin", "Baby Shark", "Megalodon", "Panda", "Sloth", "Tenrec", "Flamingo", "Zebra", 
          "Elephant", "Lemur", "Peacock", "Chameleon", "Lion", "Amber", "Dino Egg", "Dino Fossil", 
          "Stegosaurus", "Velociraptor", "Brontosaurus", "Triceratops", "Tyrannosaurus Rex", "Ice Bat", 
          "Ice Bug", "Ice Elemental", "Rock Monster", "Dink", "Donk", "Bush Monster", "Yeti", "Dingo", 
          "Echidna", "Koala", "Kookaburra", "Platypus", "Joey", "Kangaroo", "Crocodile", "Sugar Glider", 
          "Deckhand", "Buccaneer", "Swashbuckler", "Treasure Map", "Seagull", "Jolly Pirate", "Pirate Ship", 
          "Kraken", "Captain Blackbeard", "Snow Globe", "Holiday Gift", "Hot Chocolate", "Holiday Wreath", 
          "Stocking", "Gingerbread Man", "Gingerbread House", "Reindeer", "Snowman", "Santa Claus", "Pumpkin", 
          "Swamp Monster", "Frankenstein", "Vampire", "Zombie", "Mummy", "Caramel Apple", "Candy Corn", 
          "Werewolf", "Ghost", "Rainbow Jellyfish", "Blizzard Clownfish", "Lovely Frog", "Lucky Frog", 
          "Spring Frog", "Poison Dart Frog", "Lucky Hamster", "Chocolate Rabbit", "Spring Rabbit", 
          "Lemon Crab", "Pirate Pufferfish", "Donut Blobfish", "Crimson Octopus", "Rainbow Narwhal", 
          "Frost Wreath", "Tropical Globe", "New York Snow Globe", "London Snow Globe", "Japan Snow Globe", 
          "Egypt Snow Globe", "Paris Snow Globe", "Red Sweater Snowman", "Blue Sweater Snowman", 
          "Elf Sweater Snowman", "Santa Claws", "Cookies Combo", "Chilly Flamingo", "Snowy Bush Monster", 
          "Nutcracker Koala", "Sandwich", "Ice Slime", "Frozen Fossil", "Ice Crab", "Rainbow Panda", 
          "White Peacock", "Tiger Zebra", "Teal Platypus", "Red Astronaut", "Orange Astronaut", 
          "Yellow Astronaut", "Lime Astronaut", "Green Astronaut", "Cyan Astronaut", "Blue Astronaut", 
          "Pink Astronaut", "Purple Astronaut", "Brown Astronaut", "Black Astronaut", "Lovely Planet", 
          "Lovely Peacock", "Haunted Pumpkin", "Pumpkin Cookie", "Ghost Cookie", "Red Gummy Bear", 
          "Blue Gummy Bear", "Green Gummy Bear", "Chick Chicken", "Chicken Chick", "Raccoon Bandit", 
          "Owl Sheriff", "Vampire Frog", "Pumpkin King", "Leprechaun", "Anaconda Wizard", "Spooky Pumpkin", 
          "Spooky Mummy", "Agent Owl", "Master Elf", "Party Pig", "Wise Owl", "Spooky Ghost", 
          "Phantom King", "Tim the Alien", "Rainbow Astronaut", "Hamsta Claus", "Light Blue", "Black", 
          "Red", "Purple", "Pink", "Orange", "Lime", "Green", "Teal", "Tan", "Maroon", "Gray", "Mint", 
          "Salmon", "Burgandy", "Baby Blue", "Dust", "Brown", "Dull Blue", "Yellow", "Blue"
        ];

        // Populate skin dropdown
        const skinSelect = document.getElementById("skinSelect");
        blooks.forEach(skin => {
            const option = document.createElement("option");
            option.value = skin;
            option.textContent = skin;
            skinSelect.appendChild(option);
        });

        async function joinSameLobby() {
            const gameId = document.getElementById("gcode").value.trim();
            const baseUsername = document.getElementById("gname").value.trim();
            const numJoins = parseInt(document.getElementById("numJoins").value, 10);
            const selectedSkin = document.getElementById("skinSelect").value; // Get selected skin
            
            let logBox = document.getElementById("log");
            logBox.innerHTML = "";

            if (!gameId || gameId.length !== 7) {
                log("‚ùå Invalid Game Code! Must be 7 digits.");
                return;
            }
            if (!baseUsername) {
                log("‚ùå Please enter a bot name prefix.");
                return;
            }
            if (isNaN(numJoins) || numJoins <= 0 || numJoins > 100) {
                log("‚ùå Enter a valid bot count (1-100).");
                return;
            }

            log(üéÆ Joining Game ${gameId} with ${numJoins} bots...);

            for (let i = 1; i <= numJoins; i++) {
                let botName = ${baseUsername}${i};

                try {
                    // Step 1: Get Firebase Token from API
                    let response = await fetch("https://shard-uttermost-crystal.glitch.me/proxy/https://blooketbot.glitch.me/join", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ id: gameId, name: botName })
                    });

                    let data = await response.json();
                    if (!data.success) {
                        log(‚ö†Ô∏è Bot ${botName} failed: ${data.msg || "Unknown Error"});
                        continue;
                    }

                    // Step 2: Connect to Firebase
                    const liveApp = initializeApp({
                        apiKey: "AIzaSyCA-cTOnX19f6LFnDVVsHXya3k6ByP_MnU",
                        authDomain: "blooket-2020.firebaseapp.com",
                        projectId: "blooket-2020",
                        storageBucket: "blooket-2020.appspot.com",
                        messagingSenderId: "741533559105",
                        appId: "1:741533559105:web:b8cbb10e6123f2913519c0",
                        measurementId: "G-S3H5NGN10Z",
                        databaseURL: data.fbShardURL
                    });

                    const auth = getAuth(liveApp);
                    await signInWithCustomToken(auth, data.fbToken);
                    const db = getDatabase(liveApp);

                    // Step 3: Register Bot in Firebase with selected skin
                    await set(ref(db, ${gameId}/c/${botName}), { 
                        b: selectedSkin,  // Use the selected skin for all bots
                        rt: true
                    });

                    log(‚úÖ Bot ${botName} joined successfully with skin ${selectedSkin}!);
                } catch (error) {
                    log(‚ùå Error sending bot ${botName}: ${error.message});
                }

                await new Promise(r => setTimeout(r, 1000)); // Increased delay to prevent spam detection
            }

            log("üéâ All bots sent!");
        }

        function log(message) {
            let logBox = document.getElementById("log");
            logBox.innerHTML += <p>${message}</p>;
            logBox.scrollTop = logBox.scrollHeight;
        }

        // Attach event listener for bot sending
        document.getElementById("sendBotsBtn").addEventListener("click", joinSameLobby);
    </script>
</body>
</html>
